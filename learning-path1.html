<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuva Real-Math Learning Map</title>
    <style>
        :root {
            /* --- Tuva Brand Palette --- */
            --tuva-purple: #5B4896; 
            --tuva-purple-hover: #4a3a7a;
            --tuva-text-dark: #333333;
            --tuva-text-medium: #555555;
            --tuva-text-light: #777777;
            --tuva-bg-light: #F9F9F9;
            --tuva-border: #E0E0E0;

            /* --- Theme Colors (Matches Spreadsheet Contexts) --- */
            --theme-green: #4CAF50;  /* Nature/Env */
            --theme-blue: #2196F3;   /* Math/Standard */
            --theme-orange: #FF9800; /* Social/active */

            /* --- Spacing & Dimensions --- */
            --line-width: 2px;
            --dot-size: 14px;
            --card-radius: 4px; /* Standard web radius */
        }

        body {
            font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #FFFFFF;
            margin: 0;
            color: var(--tuva-text-dark);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Sidebar (Matches Tuva Filter Panel) --- */
        .sidebar {
            width: 240px;
            background-color: #FAFAFA; /* Subtle contrast */
            border-right: 1px solid var(--tuva-border);
            display: flex;
            flex-direction: column;
            padding: 30px 0;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 0 24px 20px 24px;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--tuva-text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-item {
            padding: 12px 24px;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--tuva-text-medium);
            border-left: 4px solid transparent; /* Reserve space for active indicator */
            transition: all 0.2s;
            background: transparent;
            text-align: left;
            border-top: none;
            border-right: none;
            border-bottom: none;
            width: 100%;
        }

        .nav-item:hover {
            background-color: #F0F0F0;
            color: var(--tuva-text-dark);
        }

        .nav-item.active {
            color: var(--tuva-purple);
            font-weight: 600;
            border-left-color: var(--tuva-purple); /* Tuva active style */
            background-color: #F3F1F9; /* Very light purple bg */
        }

        /* --- Main Content Area --- */
        .main-content {
            flex: 1;
            padding: 40px 60px;
            overflow-y: auto;
            background-color: #FFFFFF;
        }

        .page-header {
            margin-bottom: 50px;
            max-width: 800px;
        }

        .page-header h1 {
            font-size: 1.8rem;
            font-weight: 400;
            margin: 0 0 10px 0;
            color: var(--tuva-text-dark);
        }

        .page-header p {
            color: var(--tuva-text-light);
            font-size: 1rem;
            margin: 0;
            line-height: 1.5;
        }

        /* --- The Timeline Container --- */
        .timeline-wrapper {
            max-width: 800px;
            position: relative;
            padding-left: 10px; /* Slight offset */
        }

        /* Continuous Vertical Line */
        .timeline-line {
            position: absolute;
            left: 27px; /* Center of the dot */
            top: 10px;
            bottom: 0;
            width: var(--line-width);
            background-color: var(--tuva-border);
            z-index: 0;
        }

        /* Unit Section */
        .unit-section {
            margin-bottom: 40px;
            position: relative;
            padding-left: 60px; /* Space for line and dots */
        }

        /* Unit Title (Sitting above the skills) */
        .unit-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--tuva-text-light); /* Default gray */
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        /* The Dot (Circle) */
        .timeline-dot {
            position: absolute;
            left: 20px; /* Center aligned with line (27px center - 7px half dot) */
            top: 4px; /* Align with label text */
            width: 12px;
            height: 12px;
            background-color: #FFF;
            border: 2px solid var(--tuva-border);
            border-radius: 50%;
            z-index: 1;
            box-sizing: content-box; /* Keeps size consistent */
        }

        /* Theme Styling for Dots and Labels */
        .unit-section[data-theme="green"] .unit-label { color: var(--theme-green); }
        .unit-section[data-theme="green"] .timeline-dot { border-color: var(--theme-green); }

        .unit-section[data-theme="blue"] .unit-label { color: var(--theme-blue); }
        .unit-section[data-theme="blue"] .timeline-dot { border-color: var(--theme-blue); }

        .unit-section[data-theme="orange"] .unit-label { color: var(--theme-orange); }
        .unit-section[data-theme="orange"] .timeline-dot { border-color: var(--theme-orange); }


        /* --- Skill Card (The Item) --- */
        .skill-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #FFFFFF;
            border: 1px solid var(--tuva-border);
            border-radius: var(--card-radius);
            padding: 16px 20px;
            margin-bottom: 12px; /* Space between cards in same unit */
            cursor: pointer;
            transition: border-color 0.2s, background-color 0.2s;
            position: relative;
        }

        /* Connector Line (Horizontal) - Optional visual link to main line */
        .skill-card::before {
            content: '';
            position: absolute;
            left: -33px; /* Reach back to the vertical line */
            top: 50%;
            width: 33px;
            height: 1px;
            background-color: #F0F0F0; /* Very subtle connector */
            z-index: -1;
            display: none; /* Hidden for cleaner look, uncomment if desired */
        }

        /* Hover Effect: Flat Color Change */
        .skill-card:hover {
            border-color: var(--tuva-purple);
            background-color: #FAFAFA;
        }
        
        .skill-card:focus-visible {
            outline: 2px solid var(--tuva-purple);
            outline-offset: 2px;
        }

        .skill-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .skill-number {
            font-size: 1rem;
            font-weight: 700;
            color: var(--tuva-text-light);
            min-width: 25px;
        }

        .skill-title {
            font-size: 1rem;
            color: var(--tuva-text-dark);
            font-weight: 500;
        }

        .activity-badge {
            background-color: #F3F3F3;
            color: var(--tuva-text-medium);
            font-size: 0.8rem;
            padding: 6px 12px;
            border-radius: 4px; /* Standard Tuva badge radius */
            font-weight: 600;
        }

        /* --- Slide-out Panel (Matches Content View) --- */
        .details-panel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100vh;
            background: #FFF;
            border-left: 1px solid var(--tuva-border);
            z-index: 100;
            box-shadow: -10px 0 20px rgba(0,0,0,0.03); /* Extremely subtle shadow */
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .details-panel.open {
            right: 0;
        }

        .panel-header {
            padding: 24px;
            border-bottom: 1px solid var(--tuva-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--tuva-text-dark);
        }
        
        .panel-title span {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--tuva-text-light);
            display: block;
            margin-bottom: 4px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--tuva-text-light);
            cursor: pointer;
        }

        .panel-content {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .lesson-item {
            border: 1px solid var(--tuva-border);
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 16px;
            background: #FFF;
        }

        .lesson-tag {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--theme-green); /* Example default */
            margin-bottom: 8px;
            display: inline-block;
        }

        .lesson-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 12px;
            display: block;
            color: var(--tuva-text-dark);
        }

        .btn-action {
            display: inline-block;
            width: 100%;
            padding: 8px 0;
            text-align: center;
            border: 1px solid var(--tuva-purple);
            color: var(--tuva-purple);
            background: #FFF;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-action:hover {
            background: var(--tuva-purple);
            color: #FFF;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(255,255,255,0.7); /* White overlay instead of dark */
            backdrop-filter: blur(2px);
            z-index: 90;
            display: none;
        }
        .overlay.active { display: block; }

    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">Learning Map</div>
        
        <button class="nav-item active" onclick="switchGrade('grade3', this)">
            Grade 3
        </button>
        <button class="nav-item" onclick="switchGrade('grade4', this)">
            Grade 4
        </button>
        <button class="nav-item" onclick="switchGrade('grade5', this)">
            Grade 5
        </button>
    </aside>

    <main class="main-content">
        <div class="page-header">
            <h1 id="page-title">Grade 3 Mathematics</h1>
            <p>Select a skill to view real-world data activities aligned to your curriculum.</p>
        </div>

        <div class="timeline-wrapper">
            <div class="timeline-line"></div>

            <div id="map-content">
                </div>
        </div>
    </main>

    <div class="overlay" id="overlay" onclick="closePanel()"></div>
    <div class="details-panel" id="panel">
        <div class="panel-header">
            <div class="panel-title">
                <span id="panel-unit">Unit Name</span>
                <h3 id="panel-skill">Skill Name</h3>
            </div>
            <button class="close-btn" onclick="closePanel()">&times;</button>
        </div>
        <div class="panel-content" id="panel-body">
            </div>
    </div>

    <script>
        // Data derived from user spreadsheet
        const data = {
            grade3: [
                {
                    unit: "Place Value & Number Sense",
                    theme: "green", // Mapping Context to color
                    skills: [
                        { id: 1, name: "Round numbers to nearest 100", activities: 3, 
                          lessons: [
                              { title: "How High Are We? Altitudes of Cities", context: "Environment" }, 
                              { title: "Counting Calories", context: "Health" }
                          ] 
                        }
                    ]
                },
                {
                    unit: "Introduction to Multiplication",
                    theme: "blue",
                    skills: [
                        { id: 2, name: "Understand multiplication as equal groups", activities: 3,
                          lessons: [{ title: "How Many Animals at the Zoo?", context: "Animals" }]
                        }
                    ]
                },
                {
                    unit: "Understanding Fractions",
                    theme: "orange",
                    skills: [
                        { id: 3, name: "Compare fractions with same denominators", activities: 2,
                          lessons: [{ title: "Fractions on the Field", context: "Sports" }]
                        }
                    ]
                }
            ],
            grade4: [
                 {
                    unit: "Division",
                    theme: "blue",
                    skills: [
                        { id: 4, name: "Divide up to 4-Digit Numbers", activities: 3, lessons: [] }
                    ]
                },
                {
                    unit: "Factors & Multiples",
                    theme: "green",
                    skills: [
                         { id: 5, name: "Identify Factors and Multiples", activities: 2, lessons: [] }
                    ]
                }
            ],
            grade5: [] // Empty state test
        };

        function switchGrade(grade, btn) {
            // Update UI Active State
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update Title
            const titleMap = { 'grade3': 'Grade 3 Mathematics', 'grade4': 'Grade 4 Mathematics', 'grade5': 'Grade 5 Mathematics' };
            document.getElementById('page-title').innerText = titleMap[grade];

            renderMap(grade);
        }

        function renderMap(gradeKey) {
            const container = document.getElementById('map-content');
            container.innerHTML = '';
            
            const gradeData = data[gradeKey];

            if (!gradeData || gradeData.length === 0) {
                container.innerHTML = '<div style="padding:20px; color:#777;">No curriculum data available for this grade level yet.</div>';
                return;
            }

            gradeData.forEach(unit => {
                // Create Unit Section
                const section = document.createElement('div');
                section.className = 'unit-section';
                section.setAttribute('data-theme', unit.theme);

                // The Circle Anchor
                const dot = document.createElement('div');
                dot.className = 'timeline-dot';
                section.appendChild(dot);

                // The Label
                const label = document.createElement('div');
                label.className = 'unit-label';
                label.innerText = unit.unit;
                section.appendChild(label);

                // The Cards (Skills)
                unit.skills.forEach(skill => {
                    const card = document.createElement('div');
                    card.className = 'skill-card';
                    card.tabIndex = 0; // Accessibility
                    card.onclick = () => openPanel(unit.unit, skill);
                    
                    // HTML Structure for Card
                    card.innerHTML = `
                        <div class="skill-info">
                            <span class="skill-number">${skill.id}.</span>
                            <span class="skill-title">${skill.name}</span>
                        </div>
                        <span class="activity-badge">${skill.activities} Activities</span>
                    `;

                    section.appendChild(card);
                });

                container.appendChild(section);
            });
        }

        function openPanel(unitName, skill) {
            document.getElementById('panel-unit').innerText = unitName;
            document.getElementById('panel-skill').innerText = skill.name;
            
            const body = document.getElementById('panel-body');
            body.innerHTML = ''; // Clear previous

            if(skill.lessons.length === 0) {
                body.innerHTML = '<p style="color:#777;">No specific activities linked yet.</p>';
            } else {
                skill.lessons.forEach(lesson => {
                    const lDiv = document.createElement('div');
                    lDiv.className = 'lesson-item';
                    lDiv.innerHTML = `
                        <span class="lesson-tag" style="color:var(--tuva-purple)">${lesson.context}</span>
                        <span class="lesson-name">${lesson.title}</span>
                        <button class="btn-action">View Activity</button>
                    `;
                    body.appendChild(lDiv);
                });
            }

            document.getElementById('panel').classList.add('open');
            document.getElementById('overlay').classList.add('active');
        }

        function closePanel() {
            document.getElementById('panel').classList.remove('open');
            document.getElementById('overlay').classList.remove('active');
        }

        // Initialize
        renderMap('grade3');

    </script>
</body>
</html>
